<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promosyon Yönetim Paneli | 2'li Sistem</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* ===== VARIABLES & RESET ===== */
        :root {
            /* Light Theme Colors */
            --bg-light: #f0f2f5;
            --surface-light: #ffffff;
            --text-light: #2c3e50;
            --text-secondary-light: #7f8c8d;
            --primary-light: #3498db;
            --success-light: #2ecc71;
            --warning-light: #f39c12;
            --danger-light: #e74c3c;
            --accent-light: #9b59b6;
            --border-light: #dfe6e9;
            
            /* Neumorphism Shadows Light */
            --shadow-outset-light: 8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff;
            --shadow-inset-light: inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff;
            --shadow-soft-light: 4px 4px 8px rgba(209, 217, 230, 0.5), -4px -4px 8px rgba(255, 255, 255, 0.5);
            
            /* Dark Theme Colors */
            --bg-dark: #1a1d28;
            --surface-dark: #2d3246;
            --text-dark: #ecf0f1;
            --text-secondary-dark: #bdc3c7;
            --primary-dark: #3498db;
            --success-dark: #2ecc71;
            --warning-dark: #f39c12;
            --danger-dark: #e74c3c;
            --accent-dark: #9b59b6;
            --border-dark: #404756;
            
            /* Neumorphism Shadows Dark */
            --shadow-outset-dark: 8px 8px 16px #151822, -8px -8px 16px #1f2332;
            --shadow-inset-dark: inset 4px 4px 8px #151822, inset -4px -4px 8px #252a3a;
            --shadow-soft-dark: 4px 4px 8px rgba(21, 24, 34, 0.5), -4px -4px 8px rgba(31, 35, 50, 0.5);
            
            /* Active Theme Variables */
            --bg: var(--bg-light);
            --surface: var(--surface-light);
            --text: var(--text-light);
            --text-secondary: var(--text-secondary-light);
            --primary: var(--primary-light);
            --success: var(--success-light);
            --warning: var(--warning-light);
            --danger: var(--danger-light);
            --accent: var(--accent-light);
            --border: var(--border-light);
            --shadow-outset: var(--shadow-outset-light);
            --shadow-inset: var(--shadow-inset-light);
            --shadow-soft: var(--shadow-soft-light);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.2s ease, box-shadow 0.3s ease;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.5s ease;
        }

        .theme-dark {
            --bg: var(--bg-dark);
            --surface: var(--surface-dark);
            --text: var(--text-dark);
            --text-secondary: var(--text-secondary-dark);
            --primary: var(--primary-dark);
            --success: var(--success-dark);
            --warning: var(--warning-dark);
            --danger: var(--danger-dark);
            --accent: var(--accent-dark);
            --border: var(--border-dark);
            --shadow-outset: var(--shadow-outset-dark);
            --shadow-inset: var(--shadow-inset-dark);
            --shadow-soft: var(--shadow-soft-dark);
        }

        /* ===== LAYOUT ===== */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ===== HEADER ===== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: var(--shadow-outset);
        }

        .logo-text h1 {
            font-weight: 700;
            font-size: 24px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* ===== TABS ===== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: var(--surface);
            padding: 10px;
            border-radius: 20px;
            box-shadow: var(--shadow-outset);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 18px 24px;
            border: none;
            border-radius: 15px;
            background: var(--surface);
            color: var(--text-secondary);
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-inset);
            min-width: 200px;
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            box-shadow: var(--shadow-outset);
        }

        .tab-icon {
            font-size: 18px;
        }

        .tab-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
        }

        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== PANEL 1: KOD TAKİP ===== */
        .quick-add-form {
            background: var(--surface);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-outset);
        }

        .form-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-title i {
            color: var(--primary);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: none;
            border-radius: 15px;
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 15px;
            box-shadow: var(--shadow-inset);
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            box-shadow: var(--shadow-outset);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .form-label {
            position: absolute;
            top: -10px;
            left: 15px;
            background: var(--surface);
            padding: 0 10px;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* ===== PANEL 2: YATIRIM TAKİP ===== */
        .site-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .site-grid {
                grid-template-columns: 1fr;
            }
        }

        .site-card {
            background: var(--surface);
            border-radius: 25px;
            overflow: hidden;
            box-shadow: var(--shadow-outset);
            transition: all 0.3s ease;
        }

        .site-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-soft);
        }

        .site-card-header {
            padding: 25px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            position: relative;
        }

        .site-card-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .site-card-badge {
            width: 50px;
            height: 50px;
            border-radius: 15px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 18px;
            box-shadow: var(--shadow-outset);
            flex-shrink: 0;
        }

        .site-card-name {
            font-weight: 600;
            font-size: 18px;
            color: var(--text);
        }

        .site-card-count {
            font-size: 14px;
            color: var(--text-secondary);
            background: var(--bg);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            box-shadow: var(--shadow-inset);
            min-width: 70px;
            text-align: center;
        }

        .site-card-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, padding 0.3s ease;
        }

        .site-card.open .site-card-content {
            padding: 25px;
            max-height: 500px;
        }

        /* ===== STATS CARDS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--surface);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--shadow-outset);
            text-align: center;
        }

        .stat-icon {
            font-size: 30px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .stat-number {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* ===== USER LISTS ===== */
        .user-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .user-list::-webkit-scrollbar {
            width: 8px;
        }

        .user-list::-webkit-scrollbar-track {
            background: var(--bg);
            border-radius: 10px;
        }

        .user-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        /* PANEL 1 - User Items */
        .user-item-promo {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px;
            background: var(--bg);
            border-radius: 20px;
            box-shadow: var(--shadow-inset);
            transition: all 0.2s ease;
            gap: 15px;
        }

        .user-item-promo:hover {
            box-shadow: var(--shadow-outset);
            transform: translateX(5px);
        }

        .user-info-promo {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 0;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
            flex-shrink: 0;
            box-shadow: var(--shadow-outset);
        }

        .user-name-promo {
            font-weight: 500;
            font-size: 15px;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-details-promo {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 12px;
            flex-shrink: 0;
            text-align: right;
        }

        .user-date-promo {
            color: var(--warning);
            font-weight: 600;
            padding: 5px 10px;
            background: var(--bg);
            border-radius: 12px;
            box-shadow: var(--shadow-inset);
            white-space: nowrap;
        }

        .user-source-promo {
            color: var(--success);
            font-weight: 600;
            white-space: nowrap;
            font-size: 11px;
        }

        /* PANEL 2 - User Items */
        .user-item-yatirim {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px;
            background: var(--bg);
            border-radius: 20px;
            box-shadow: var(--shadow-inset);
            transition: all 0.2s ease;
            gap: 15px;
        }

        .user-item-yatirim:hover {
            box-shadow: var(--shadow-outset);
            transform: translateX(5px);
        }

        .user-info-yatirim {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
            min-width: 0;
        }

        .user-status {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--danger);
            position: relative;
            flex-shrink: 0;
        }

        .user-status.active {
            background: var(--success);
            box-shadow: 0 0 12px rgba(46, 204, 113, 0.5);
        }

        .user-name-yatirim {
            font-weight: 500;
            font-size: 15px;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-details-yatirim {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            flex-shrink: 0;
        }

        .user-days {
            color: var(--warning);
            font-weight: 600;
            padding: 5px 10px;
            background: var(--bg);
            border-radius: 12px;
            box-shadow: var(--shadow-inset);
            white-space: nowrap;
        }

        .user-claimed {
            color: var(--success);
            font-weight: 600;
            white-space: nowrap;
        }

        .user-expired {
            color: var(--danger);
            font-weight: 600;
            white-space: nowrap;
        }

        /* ===== ACTION BUTTONS ===== */
        .user-actions {
            display: flex;
            gap: 10px;
            flex-shrink: 0;
        }

        /* ===== FORM CONTROLS ===== */
        .user-form {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 15px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-outset);
            white-space: nowrap;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-inset);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #2980b9);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-icon {
            font-size: 16px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-outset);
            border: none;
            background: var(--surface);
            color: var(--text);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-soft);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--primary), #2980b9);
            color: white;
        }

        .action-btn.success {
            background: linear-gradient(135deg, var(--success), #27ae60);
            color: white;
        }

        .action-btn.danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        /* ===== SEARCH BAR ===== */
        .search-container {
            margin-bottom: 30px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 18px 20px 18px 50px;
            border: none;
            border-radius: 20px;
            background: var(--surface);
            color: var(--text);
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            box-shadow: var(--shadow-inset);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            box-shadow: var(--shadow-outset);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 18px;
        }

        /* ===== THEME TOGGLE ===== */
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .theme-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--surface);
            border-radius: 34px;
            box-shadow: var(--shadow-inset);
            transition: .4s;
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: var(--primary);
            border-radius: 50%;
            transition: .4s;
            box-shadow: var(--shadow-soft);
        }

        input:checked + .theme-slider {
            background-color: var(--surface);
        }

        input:checked + .theme-slider:before {
            transform: translateX(30px);
        }

        .theme-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            z-index: 1;
        }

        .sun-icon {
            left: 8px;
            color: var(--warning);
        }

        .moon-icon {
            right: 8px;
            color: var(--text-secondary);
        }

        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            padding: 20px;
        }

        .modal-content {
            background: var(--surface);
            border-radius: 25px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-outset);
            animation: modalFadeIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
        }

        .modal-close {
            background: var(--bg);
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-inset);
        }

        .modal-close:hover {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-outset);
        }

        /* ===== LOADING & EMPTY STATES ===== */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 16px;
            margin-bottom: 15px;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .header-controls {
                width: 100%;
                justify-content: space-between;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                min-width: 100%;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .site-card-header {
                padding: 20px;
            }
            
            .user-item-promo, .user-item-yatirim {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .user-actions {
                width: 100%;
                justify-content: flex-end;
            }
            
            .btn {
                padding: 14px 20px;
            }
        }

        @media (max-width: 480px) {
            .site-card-badge {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .site-card-name {
                font-size: 16px;
            }
            
            .user-form {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .btn {
                width: 100%;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* ===== UTILITY CLASSES ===== */
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .text-primary { color: var(--primary); }
        .text-secondary { color: var(--text-secondary); }

        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .mt-20 { margin-top: 20px; }
        .mt-30 { margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="logo-text">
                    <h1>Promosyon Yönetim</h1>
                    <p>2'li Sistem | Kod & Yatırım Takibi</p>
                </div>
            </div>
            
            <div class="header-controls">
                <div class="theme-toggle">
                    <input type="checkbox" id="theme-switch">
                    <label for="theme-switch" class="theme-slider">
                        <span class="theme-icon sun-icon"><i class="fas fa-sun"></i></span>
                        <span class="theme-icon moon-icon"><i class="fas fa-moon"></i></span>
                    </label>
                </div>
                <button class="btn btn-primary" onclick="showSettingsModal()">
                    <i class="fas fa-cog btn-icon"></i> Ayarlar
                </button>
            </div>
        </header>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab(1)">
                <i class="fas fa-gift tab-icon"></i>
                <span>Promosyon Kodları</span>
                <span class="tab-count" id="tab1-count">0</span>
            </button>
            <button class="tab" onclick="switchTab(2)">
                <i class="fas fa-money-bill-wave tab-icon"></i>
                <span>Yatırım Takibi</span>
                <span class="tab-count" id="tab2-count">0</span>
            </button>
        </div>

        <!-- TAB 1: PROMOSYON KODLARI -->
        <div class="tab-content active" id="tab1-content">
            <!-- QUICK ADD FORM -->
            <div class="quick-add-form">
                <div class="form-title">
                    <i class="fas fa-bolt"></i> Hızlı Ekle
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <div class="form-label">Site Adı</div>
                        <input type="text" class="form-input" id="site-name-input" 
                               placeholder="Örn: Pusulabet, Megabahis..." 
                               onkeydown="if(event.key === 'Enter') addPromoCode()">
                    </div>
                    
                    <div class="form-group">
                        <div class="form-label">Kullanıcı Adı</div>
                        <input type="text" class="form-input" id="user-name-input" 
                               placeholder="Kullanıcı adını girin..."
                               onkeydown="if(event.key === 'Enter') addPromoCode()">
                    </div>
                    
                    <div class="form-group">
                        <div class="form-label">Promosyon Tarihi</div>
                        <input type="date" class="form-input" id="promo-date-input"
                               onkeydown="if(event.key === 'Enter') addPromoCode()">
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="addPromoCode()" style="width: 100%;">
                    <i class="fas fa-plus-circle btn-icon"></i> Promosyon Kodu Ekle
                </button>
            </div>

            <!-- STATS CARDS -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-globe"></i>
                    </div>
                    <div class="stat-number" id="total-sites">0</div>
                    <div class="stat-label">Toplam Site</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number" id="total-users-promo">0</div>
                    <div class="stat-label">Toplam Kullanıcı</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="stat-number" id="today-count">0</div>
                    <div class="stat-label">Bugün Eklenen</div>
                </div>
            </div>

            <!-- SEARCH BAR -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="search-promo" 
                           placeholder="Site adı veya kullanıcı adı ara...">
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="action-buttons">
                <button class="action-btn success" onclick="exportPromoData()">
                    <i class="fas fa-file-export"></i> Dışa Aktar
                </button>
                <button class="action-btn danger" onclick="clearPromoData()">
                    <i class="fas fa-trash-alt"></i> Temizle
                </button>
                <button class="action-btn" onclick="showHelpModal(1)">
                    <i class="fas fa-question-circle"></i> Yardım
                </button>
            </div>

            <!-- MAIN CONTENT -->
            <div id="promo-list" class="site-grid"></div>
            
            <!-- Empty State -->
            <div id="empty-state-promo" class="empty-state" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="empty-text">Henüz promosyon kodu eklenmemiş</div>
                <button class="btn btn-primary" onclick="document.getElementById('site-name-input').focus()">
                    <i class="fas fa-plus btn-icon"></i> İlk Kodunu Ekle
                </button>
            </div>
        </div>

        <!-- TAB 2: YATIRIM TAKİBİ -->
        <div class="tab-content" id="tab2-content">
            <!-- SEARCH BAR -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="search-yatirim" 
                           placeholder="Kullanıcı adı veya site adı ara...">
                </div>
            </div>

            <!-- ACTION BUTTONS -->
            <div class="action-buttons">
                <button class="action-btn primary" onclick="showAddSiteModal()">
                    <i class="fas fa-plus"></i> Site Ekle
                </button>
                <button class="action-btn success" onclick="exportYatirimData()">
                    <i class="fas fa-file-export"></i> Dışa Aktar
                </button>
                <button class="action-btn" onclick="showHelpModal(2)">
                    <i class="fas fa-question-circle"></i> Yardım
                </button>
            </div>

            <!-- STATS CARDS -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-sitemap"></i>
                    </div>
                    <div class="stat-number" id="total-sites-yatirim">0</div>
                    <div class="stat-label">Toplam Site</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-friends"></i>
                    </div>
                    <div class="stat-number" id="total-users-yatirim">0</div>
                    <div class="stat-label">Toplam Kullanıcı</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-number" id="claimed-count">0</div>
                    <div class="stat-label">Alınan Promosyon</div>
                </div>
            </div>

            <!-- MAIN CONTENT -->
            <div id="site-list" class="site-grid"></div>
            
            <!-- Empty State -->
            <div id="empty-state-yatirim" class="empty-state" style="display: none;">
                <div class="empty-icon">
                    <i class="fas fa-inbox"></i>
                </div>
                <div class="empty-text">Henüz site eklenmemiş</div>
                <button class="btn btn-primary" onclick="showAddSiteModal()">
                    <i class="fas fa-plus btn-icon"></i> İlk Siteyi Ekle
                </button>
            </div>
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Ayarlar</h2>
                <button class="modal-close" onclick="hideModal('settings')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-30">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text);">Tema Ayarları</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn" onclick="setTheme('light')" id="theme-light">
                        <i class="fas fa-sun btn-icon"></i> Aydınlık
                    </button>
                    <button class="btn" onclick="setTheme('dark')" id="theme-dark">
                        <i class="fas fa-moon btn-icon"></i> Karanlık
                    </button>
                    <button class="btn" onclick="setTheme('auto')" id="theme-auto">
                        <i class="fas fa-adjust btn-icon"></i> Otomatik
                    </button>
                </div>
            </div>
            
            <div class="mb-30">
                <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; color: var(--text);">Veri İşlemleri</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="importPromoData()">
                        <i class="fas fa-file-import btn-icon"></i> Kodları İçe Aktar
                    </button>
                    <button class="btn btn-success" onclick="importYatirimData()">
                        <i class="fas fa-file-import btn-icon"></i> Yatırımları İçe Aktar
                    </button>
                </div>
            </div>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="hideModal('settings')">
                <i class="fas fa-check btn-icon"></i> Tamam
            </button>
        </div>
    </div>

    <!-- ADD SITE MODAL -->
    <div class="modal-overlay" id="add-site-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Yeni Site Ekle</h2>
                <button class="modal-close" onclick="hideModal('add-site')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-30">
                <input type="text" id="new-site-name" class="form-input mb-20" placeholder="Site adı">
                <div style="color: var(--text-secondary); font-size: 14px; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> Site adı büyük/küçük harf duyarlıdır
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-success" style="flex: 1;" onclick="addNewSite()">
                    <i class="fas fa-plus btn-icon"></i> Ekle
                </button>
                <button class="btn" style="flex: 1;" onclick="hideModal('add-site')">
                    <i class="fas fa-times btn-icon"></i> İptal
                </button>
            </div>
        </div>
    </div>

    <!-- ADD USER MODAL -->
    <div class="modal-overlay" id="add-user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="add-user-title">Kullanıcı Ekle</h2>
                <button class="modal-close" onclick="hideModal('add-user')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-30">
                <input type="text" id="new-user-name" class="form-input mb-20" placeholder="Kullanıcı Adı">
                <input type="date" id="new-user-date" class="form-input mb-20" placeholder="Yatırım Tarihi">
                <div style="color: var(--text-secondary); font-size: 14px;">
                    <i class="fas fa-info-circle"></i> Tarih belirtmezseniz promosyon alınamaz
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-success" style="flex: 1;" onclick="addNewUser()">
                    <i class="fas fa-plus btn-icon"></i> Ekle
                </button>
                <button class="btn" style="flex: 1;" onclick="hideModal('add-user')">
                    <i class="fas fa-times btn-icon"></i> İptal
                </button>
            </div>
        </div>
    </div>

    <!-- EDIT DATE MODAL -->
    <div class="modal-overlay" id="edit-date-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="edit-date-title">Tarih Düzenle</h2>
                <button class="modal-close" onclick="hideModal('edit-date')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-30">
                <div class="date-picker" style="display: flex; align-items: center; gap: 10px;">
                    <input type="date" id="edit-date-input" class="form-input" style="flex: 1;">
                    <button class="btn btn-success" onclick="saveEditDate()">
                        <i class="fas fa-save btn-icon"></i> Kaydet
                    </button>
                </div>
            </div>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="hideModal('edit-date')">
                <i class="fas fa-check btn-icon"></i> Tamam
            </button>
        </div>
    </div>

    <!-- EDIT PROMO MODAL -->
    <div class="modal-overlay" id="edit-promo-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Promosyon Düzenle</h2>
                <button class="modal-close" onclick="hideModal('edit-promo')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-30">
                <div class="form-group mb-20">
                    <div class="form-label">Site Adı</div>
                    <input type="text" class="form-input" id="edit-site-name">
                </div>
                
                <div class="form-group mb-20">
                    <div class="form-label">Kullanıcı Adı</div>
                    <input type="text" class="form-input" id="edit-user-name">
                </div>
                
                <div class="form-group">
                    <div class="form-label">Promosyon Tarihi</div>
                    <input type="date" class="form-input" id="edit-promo-date">
                </div>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-success" style="flex: 1;" onclick="savePromoEdit()">
                    <i class="fas fa-save btn-icon"></i> Kaydet
                </button>
                <button class="btn" style="flex: 1;" onclick="hideModal('edit-promo')">
                    <i class="fas fa-times btn-icon"></i> İptal
                </button>
            </div>
        </div>
    </div>

    <!-- CONFIRM MODAL -->
    <div class="modal-overlay" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Onay Gerekli</h2>
                <button class="modal-close" onclick="hideModal('confirm')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-30">
                <p style="font-size: 16px; line-height: 1.6; color: var(--text);" id="confirm-message">
                    Bu işlemi gerçekleştirmek istediğinize emin misiniz?
                </p>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-danger" style="flex: 1;" id="confirm-action-btn">
                    <i class="fas fa-check btn-icon"></i> Evet
                </button>
                <button class="btn" style="flex: 1;" onclick="hideModal('confirm')">
                    <i class="fas fa-times btn-icon"></i> İptal
                </button>
            </div>
        </div>
    </div>

    <!-- HELP MODAL -->
    <div class="modal-overlay" id="help-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="help-title">Yardım</h2>
                <button class="modal-close" onclick="hideModal('help')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-30">
                <div style="color: var(--text); line-height: 1.7;" id="help-content">
                    <!-- Content will be filled by JavaScript -->
                </div>
            </div>
            
            <button class="btn btn-primary" style="width: 100%;" onclick="hideModal('help')">
                <i class="fas fa-check btn-icon"></i> Tamam
            </button>
        </div>
    </div>

    <script>
        // ===== FIREBASE CONFIG =====
        const firebaseConfig = {
            apiKey: "AIzaSyA_AB1QtRr3bBHi5LXxeTKECtgPJrfyRa4",
            authDomain: "deneme-b8281.firebaseapp.com",
            projectId: "deneme-b8281",
            storageBucket: "deneme-b8281.firebasestorage.app",
            messagingSenderId: "844910163064",
            appId: "1:844910163064:web:f4ad80295fb39d1322698d"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ===== DATA =====
        const sites = ["Nakitbahis", "Mavibet", "Odeonbet", "Megabahis", "Kavbet", "Jojobet", "Matbet", "Pusulabet",
                      "HIZLICASİNO", "EGEBET", "TURBOSLOT", "HOLİGAN", "BETSMOVE", "LUNABET", "ELİTCASİNO", "COINBAR"];
        
        const kuralsizSiteler = ["JOJOBET", "MATBET", "PUSULABET"];

        // ===== STATE =====
        let currentTab = 1;
        let currentSite = '';
        let currentUser = { id: '', name: '', site: '' };
        let siteListeners = {};
        let allSites = [...sites];
        let allPromoCodes = [];
        let currentEditId = null;

        // ===== THEME MANAGEMENT =====
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            if (savedTheme === 'auto') {
                setTheme(prefersDark ? 'dark' : 'light');
            } else {
                setTheme(savedTheme);
            }
            
            document.getElementById('theme-switch').checked = savedTheme === 'dark';
            
            // Update theme buttons
            document.querySelectorAll('#theme-light, #theme-dark, #theme-auto').forEach(btn => {
                btn.classList.remove('btn-primary');
            });
            document.getElementById(`theme-${savedTheme}`).classList.add('btn-primary');
        }

        function setTheme(theme) {
            if (theme === 'auto') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.body.classList.toggle('theme-dark', prefersDark);
                localStorage.setItem('theme', 'auto');
                document.getElementById('theme-switch').checked = prefersDark;
            } else {
                document.body.classList.toggle('theme-dark', theme === 'dark');
                localStorage.setItem('theme', theme);
                document.getElementById('theme-switch').checked = theme === 'dark';
            }
            
            // Update theme buttons
            document.querySelectorAll('#theme-light, #theme-dark, #theme-auto').forEach(btn => {
                btn.classList.remove('btn-primary');
            });
            document.getElementById(`theme-${theme}`).classList.add('btn-primary');
        }

        // ===== TAB MANAGEMENT =====
        function switchTab(tabNumber) {
            // Update tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            document.querySelector(`.tab:nth-child(${tabNumber})`).classList.add('active');
            document.getElementById(`tab${tabNumber}-content`).classList.add('active');
            
            currentTab = tabNumber;
            
            // Update stats for active tab
            if (tabNumber === 1) {
                updatePromoStats();
            } else {
                updateYatirimStats();
            }
        }

        // ===== MODAL FUNCTIONS =====
        function showModal(modalId) {
            document.getElementById(`${modalId}-modal`).style.display = 'flex';
        }

        function hideModal(modalId) {
            document.getElementById(`${modalId}-modal`).style.display = 'none';
        }

        function showSettingsModal() {
            showModal('settings');
        }

        function showAddSiteModal() {
            document.getElementById('new-site-name').value = '';
            showModal('add-site');
        }

        function showAddUserModal(siteAd, siteName) {
            currentSite = siteAd;
            document.getElementById('add-user-title').textContent = `${siteName} - Kullanıcı Ekle`;
            document.getElementById('new-user-name').value = '';
            document.getElementById('new-user-date').value = '';
            showModal('add-user');
        }

        function showEditDateModal(siteAd, userId, userName) {
            currentUser = { id: userId, name: userName, site: siteAd };
            document.getElementById('edit-date-title').textContent = `${userName} - Tarih Düzenle`;
            
            // Load current date
            db.collection(siteAd).doc(userId).get().then(doc => {
                if (doc.exists) {
                    const user = doc.data();
                    document.getElementById('edit-date-input').value = user.lastDepositDate || '';
                }
            });
            
            showModal('edit-date');
        }

        function showEditPromoModal(promoId, siteName, userName, promoDate) {
            currentEditId = promoId;
            document.getElementById('edit-site-name').value = siteName;
            document.getElementById('edit-user-name').value = userName;
            document.getElementById('edit-promo-date').value = promoDate;
            showModal('edit-promo');
        }

        function showConfirmModal(message = 'Bu işlemi gerçekleştirmek istediğinize emin misiniz?', action = null, actionText = 'Evet') {
            document.getElementById('confirm-message').textContent = message;
            
            const actionBtn = document.getElementById('confirm-action-btn');
            actionBtn.innerHTML = `<i class="fas fa-check btn-icon"></i> ${actionText}`;
            
            // Remove previous event listeners
            const newActionBtn = actionBtn.cloneNode(true);
            actionBtn.parentNode.replaceChild(newActionBtn, actionBtn);
            
            if (action) {
                newActionBtn.onclick = action;
            }
            
            showModal('confirm');
        }

        function showHelpModal(tabNumber) {
            const helpTitle = document.getElementById('help-title');
            const helpContent = document.getElementById('help-content');
            
            if (tabNumber === 1) {
                helpTitle.textContent = 'Promosyon Kodları Yardım';
                helpContent.innerHTML = `
                    <h3 style="margin-bottom: 10px; color: var(--primary);">Nasıl Kullanılır:</h3>
                    <ul style="padding-left: 20px; margin-bottom: 20px;">
                        <li><strong>Hızlı Ekle:</strong> Site adı, kullanıcı adı ve tarih girerek promosyon kodunu ekleyin</li>
                        <li><strong>Site Kartları:</strong> Her site için ayrı kart oluşturulur (Pusulabet x2 gibi)</li>
                        <li><strong>Düzenleme:</strong> Kalem ikonuna tıklayarak promosyon bilgilerini düzenleyin</li>
                        <li><strong>Silme:</strong> Çöp kutusu ikonuna tıklayarak kaydı silin</li>
                        <li><strong>Arama:</strong> Site adı veya kullanıcı adına göre filtreleme yapın</li>
                    </ul>
                    
                    <h3 style="margin-bottom: 10px; color: var(--primary);">Özellikler:</h3>
                    <ul style="padding-left: 20px;">
                        <li>Aynı siteden birden fazla kullanıcı ekleyebilme</li>
                        <li>Site bazlı gruplama ve sayma (Pusulabet x2)</li>
                        <li>Tarihe göre filtreleme</li>
                        <li>İstatistikler paneli</li>
                        <li>Veri dışa/içe aktarma</li>
                    </ul>
                `;
            } else {
                helpTitle.textContent = 'Yatırım Takibi Yardım';
                helpContent.innerHTML = `
                    <h3 style="margin-bottom: 10px; color: var(--primary);">Nasıl Kullanılır:</h3>
                    <ul style="padding-left: 20px; margin-bottom: 20px;">
                        <li>Site eklemek için "Site Ekle" butonunu kullanın</li>
                        <li>Site kartına tıklayarak kullanıcıları görüntüleyin</li>
                        <li>Kullanıcı eklemek için site içindeki formu kullanın</li>
                        <li>Yeşil LED'e tıklayarak promosyon alındı olarak işaretleyin</li>
                        <li>Takvim ikonuna tıklayarak tarih düzenleyin</li>
                        <li>Arama ile kullanıcı veya site bulun</li>
                    </ul>
                    
                    <h3 style="margin-bottom: 10px; color: var(--primary);">Özellikler:</h3>
                    <ul style="padding-left: 20px;">
                        <li>Kurallı/Kuralsız site ayrımı</li>
                        <li>7 günlük takip sistemi</li>
                        <li>Otomatik süre takibi</li>
                        <li>Gerçek zamanlı veri senkronizasyonu</li>
                        <li>Mobil uyumlu tasarım</li>
                    </ul>
                `;
            }
            
            showModal('help');
        }

        // ===== PANEL 1: PROMOSYON KODLARI =====
        function addPromoCode() {
            const siteName = document.getElementById('site-name-input').value.trim();
            const userName = document.getElementById('user-name-input').value.trim();
            const promoDate = document.getElementById('promo-date-input').value;
            
            if (!siteName) {
                showToast('Lütfen site adı girin!', 'warning');
                document.getElementById('site-name-input').focus();
                return;
            }
            
            if (!userName) {
                showToast('Lütfen kullanıcı adı girin!', 'warning');
                document.getElementById('user-name-input').focus();
                return;
            }
            
            // Add to database
            db.collection('promoCodes').add({
                siteName: siteName,
                userName: userName,
                promoDate: promoDate || new Date().toISOString().split('T')[0],
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                // Clear inputs
                document.getElementById('site-name-input').value = '';
                document.getElementById('user-name-input').value = '';
                document.getElementById('promo-date-input').value = '';
                
                showToast('Promosyon kodu başarıyla eklendi!', 'success');
            }).catch(error => {
                showToast('Bir hata oluştu!', 'danger');
                console.error("Error adding promo code: ", error);
            });
        }

        function savePromoEdit() {
            const siteName = document.getElementById('edit-site-name').value.trim();
            const userName = document.getElementById('edit-user-name').value.trim();
            const promoDate = document.getElementById('edit-promo-date').value;
            
            if (!siteName || !userName) {
                showToast('Lütfen tüm alanları doldurun!', 'warning');
                return;
            }
            
            db.collection('promoCodes').doc(currentEditId).update({
                siteName: siteName,
                userName: userName,
                promoDate: promoDate
            }).then(() => {
                hideModal('edit-promo');
                showToast('Promosyon kodu güncellendi!', 'success');
            }).catch(error => {
                showToast('Güncelleme sırasında hata oluştu!', 'danger');
                console.error(error);
            });
        }

        function deletePromoCode(promoId, userName) {
            showConfirmModal(
                `${userName} kullanıcısının promosyon kaydını silmek istediğinize emin misiniz?`,
                () => {
                    db.collection('promoCodes').doc(promoId).delete().then(() => {
                        showToast('Promosyon kaydı silindi!', 'success');
                    });
                },
                'Sil'
            );
        }

        function groupPromosBySite(promos) {
            const grouped = {};
            
            promos.forEach(promo => {
                const siteName = promo.siteName;
                if (!grouped[siteName]) {
                    grouped[siteName] = [];
                }
                grouped[siteName].push(promo);
            });
            
            return grouped;
        }

        function renderPromoCards(groupedPromos) {
            const promoList = document.getElementById('promo-list');
            promoList.innerHTML = '';
            
            Object.keys(groupedPromos).sort().forEach(siteName => {
                const promos = groupedPromos[siteName];
                const cardId = `promo-card-${siteName.replace(/\s/g, '-')}`;
                
                // Get first two letters for badge
                const badgeText = siteName.substring(0, 2).toUpperCase();
                
                const card = document.createElement('div');
                card.className = 'site-card fade-in';
                card.id = cardId;
                
                card.innerHTML = `
                    <div class="site-card-header" onclick="toggleSiteCard('${cardId}')">
                        <div class="site-card-title">
                            <div class="site-card-badge">${badgeText}</div>
                            <div class="site-card-name">${siteName} <span class="text-secondary">x${promos.length}</span></div>
                        </div>
                        <div class="site-card-count">${promos.length}</div>
                    </div>
                    <div class="site-card-content">
                        <div class="user-list" id="users-${cardId}">
                            ${renderPromoUserList(promos)}
                        </div>
                    </div>
                `;
                
                promoList.appendChild(card);
            });
            
            updatePromoEmptyState();
            updatePromoStats();
            updateTabCounts();
        }

        function renderPromoUserList(promos) {
            if (promos.length === 0) {
                return `
                    <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                        <i class="fas fa-users" style="font-size: 40px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Henüz kullanıcı eklenmemiş</p>
                    </div>
                `;
            }
            
            return promos.map(promo => {
                // Get initials for avatar
                const initials = promo.userName.substring(0, 2).toUpperCase();
                const date = new Date(promo.promoDate);
                const formattedDate = date.toLocaleDateString('tr-TR');
                
                return `
                    <div class="user-item-promo">
                        <div class="user-info-promo">
                            <div class="user-avatar">${initials}</div>
                            <div class="user-name-promo">${promo.userName}</div>
                            <div class="user-details-promo">
                                <div class="user-date-promo">${formattedDate}</div>
                                <div class="user-source-promo">${promo.siteName}</div>
                            </div>
                        </div>
                        <div class="user-actions">
                            <button class="btn" style="padding: 10px 14px; font-size: 13px;" 
                                    onclick="showEditPromoModal('${promo.id}', '${promo.siteName}', '${promo.userName}', '${promo.promoDate}')">
                                <i class="fas fa-edit btn-icon"></i>
                            </button>
                            <button class="btn btn-danger" style="padding: 10px 14px; font-size: 13px;" 
                                    onclick="deletePromoCode('${promo.id}', '${promo.userName}')">
                                <i class="fas fa-trash-alt btn-icon"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updatePromoStats() {
            const totalSites = Object.keys(groupPromosBySite(allPromoCodes)).length;
            const totalUsers = allPromoCodes.length;
            
            // Count today's entries
            const today = new Date().toISOString().split('T')[0];
            const todayCount = allPromoCodes.filter(promo => 
                promo.promoDate === today
            ).length;
            
            document.getElementById('total-sites').textContent = totalSites;
            document.getElementById('total-users-promo').textContent = totalUsers;
            document.getElementById('today-count').textContent = todayCount;
        }

        function updatePromoEmptyState() {
            const promoList = document.getElementById('promo-list');
            const emptyState = document.getElementById('empty-state-promo');
            
            if (promoList.children.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }

        // ===== PANEL 2: YATIRIM TAKİBİ =====
        function addNewSite() {
            const siteNameInput = document.getElementById('new-site-name');
            const siteName = siteNameInput.value.trim();
            
            if (!siteName) {
                showToast('Lütfen site adı girin!', 'warning');
                return;
            }
            
            if (allSites.includes(siteName)) {
                showToast('Bu site zaten mevcut!', 'warning');
                return;
            }
            
            allSites.push(siteName);
            hideModal('add-site');
            createSiteCard(siteName);
            showToast('Site başarıyla eklendi!', 'success');
            
            // Save to localStorage
            localStorage.setItem('customSites', JSON.stringify(allSites.filter(s => !sites.includes(s))));
        }

        function createSiteCard(siteName) {
            const cleanName = siteName;
            const dbAd = cleanName.replace(/\s/g, '').toUpperCase();
            const cardId = `card-${dbAd}`;
            
            const card = document.createElement('div');
            card.className = 'site-card fade-in';
            card.id = cardId;
            
            // Get first two letters for badge
            const badgeText = cleanName.substring(0, 2).toUpperCase();
            
            card.innerHTML = `
                <div class="site-card-header" onclick="toggleSiteCard('${cardId}')">
                    <div class="site-card-title">
                        <div class="site-card-badge">${badgeText}</div>
                        <div class="site-card-name">${cleanName}</div>
                    </div>
                    <div class="site-card-count" id="count-${dbAd}">0</div>
                </div>
                <div class="site-card-content">
                    <div class="user-list" id="users-${dbAd}">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                    <div class="user-form">
                        <input type="text" class="form-input" id="name-${dbAd}" 
                               placeholder="Kullanıcı adı girin..." 
                               onkeydown="if(event.key === 'Enter') addUser('${dbAd}', '${cleanName}')">
                        <button class="btn btn-success" onclick="addUser('${dbAd}', '${cleanName}')">
                            <i class="fas fa-plus btn-icon"></i> Ekle
                        </button>
                        <button class="btn btn-primary" onclick="showAddUserModal('${dbAd}', '${cleanName}')">
                            <i class="fas fa-edit btn-icon"></i> Detaylı
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('site-list').appendChild(card);
            
            // Setup listener for this site
            if (!siteListeners[dbAd]) {
                siteListeners[dbAd] = db.collection(dbAd).orderBy("createdAt", "asc")
                    .onSnapshot(snap => renderYatirimUsers(dbAd, snap));
            }
            
            // Update empty state
            updateYatirimEmptyState();
            updateYatirimStats();
            updateTabCounts();
        }

        function addUser(siteAd, siteName, userName = null, userDate = null) {
            let nameInput, dateInput;
            
            if (userName) {
                nameInput = { value: userName };
                dateInput = { value: userDate || '' };
                hideModal('add-user');
            } else {
                nameInput = document.getElementById(`name-${siteAd}`);
                dateInput = { value: '' };
            }
            
            if (!nameInput.value.trim()) {
                showToast('Lütfen kullanıcı adı girin!', 'warning');
                return;
            }
            
            db.collection(siteAd).add({
                name: nameInput.value.trim(),
                lastDepositDate: dateInput.value || "",
                lastClaimDate: "", 
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                if (!userName) {
                    nameInput.value = "";
                    nameInput.focus();
                }
                showToast('Kullanıcı başarıyla eklendi!', 'success');
            }).catch(error => {
                showToast('Bir hata oluştu!', 'danger');
                console.error("Error adding user: ", error);
            });
        }

        function addNewUser() {
            const userName = document.getElementById('new-user-name').value;
            const userDate = document.getElementById('new-user-date').value;
            
            if (!userName.trim()) {
                showToast('Lütfen kullanıcı adı girin!', 'warning');
                return;
            }
            
            addUser(currentSite, '', userName, userDate);
        }

        function saveEditDate() {
            const dateValue = document.getElementById('edit-date-input').value;
            
            db.collection(currentUser.site).doc(currentUser.id).update({ 
                lastDepositDate: dateValue 
            }).then(() => {
                hideModal('edit-date');
                showToast('Tarih güncellendi!', 'success');
            });
        }

        function claimPromo(siteAd, docId) {
            const d = new Date();
            const dateStr = d.toLocaleDateString('tr-TR') + " " + 
                           d.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
            
            db.collection(siteAd).doc(docId).update({ 
                lastClaimDate: dateStr 
            }).then(() => {
                showToast('Promosyon alındı olarak işaretlendi!', 'success');
            });
        }

        function deleteUser(siteAd, docId, userName) {
            showConfirmModal(
                `${userName} kullanıcısını silmek istediğinize emin misiniz?`,
                () => {
                    db.collection(siteAd).doc(docId).delete().then(() => {
                        showToast('Kullanıcı silindi!', 'success');
                    });
                },
                'Sil'
            );
        }

        function renderYatirimUsers(siteAd, snapshot) {
            const container = document.getElementById(`users-${siteAd}`);
            const countElement = document.getElementById(`count-${siteAd}`);
            
            if (!container || !countElement) return;
            
            container.innerHTML = "";
            countElement.textContent = snapshot.size;
            
            if (snapshot.size === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: var(--text-secondary);">
                        <i class="fas fa-users" style="font-size: 40px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Henüz kullanıcı eklenmemiş</p>
                    </div>
                `;
                return;
            }
            
            const today = new Date().toLocaleDateString('tr-TR');
            let claimedCount = 0;
            
            snapshot.forEach(doc => {
                const user = doc.data();
                const claimedToday = user.lastClaimDate && user.lastClaimDate.split(' ')[0] === today;
                if (claimedToday) claimedCount++;
                
                const isRuleFree = kuralsizSiteler.includes(siteAd);
                const daysPast = getDaysDiff(user.lastDepositDate);
                const canClaim = isRuleFree || (user.lastDepositDate && daysPast >= 0 && daysPast <= 7);
                const daysLeft = 7 - daysPast;
                
                const userElement = document.createElement('div');
                userElement.className = 'user-item-yatirim';
                
                let statusText = '';
                let statusClass = '';
                if (claimedToday) {
                    statusText = 'Bugün alındı';
                    statusClass = 'user-claimed';
                } else if (!isRuleFree) {
                    if (user.lastDepositDate) {
                        if (canClaim) {
                            statusText = `${daysLeft} gün kaldı`;
                            statusClass = 'user-days';
                        } else {
                            statusText = 'Süre doldu';
                            statusClass = 'user-expired';
                        }
                    } else {
                        statusText = 'Tarih yok';
                        statusClass = 'text-secondary';
                    }
                }
                
                userElement.innerHTML = `
                    <div class="user-info-yatirim">
                        <div class="user-status ${claimedToday ? 'active' : ''}" 
                             onclick="if(${canClaim} && !${claimedToday}) claimPromo('${siteAd}', '${doc.id}')"
                             style="${!canClaim && !claimedToday ? 'cursor: not-allowed; opacity: 0.5;' : 'cursor: pointer;'}"></div>
                        <div class="user-name-yatirim">${user.name}</div>
                        <div class="user-details-yatirim">
                            ${statusText ? `<span class="${statusClass}">${statusText}</span>` : ''}
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn" style="padding: 10px 14px; font-size: 13px;" 
                                onclick="showEditDateModal('${siteAd}', '${doc.id}', '${user.name}')">
                            <i class="fas fa-calendar-alt btn-icon"></i>
                        </button>
                        <button class="btn btn-danger" style="padding: 10px 14px; font-size: 13px;" 
                                onclick="deleteUser('${siteAd}', '${doc.id}', '${user.name}')">
                            <i class="fas fa-trash-alt btn-icon"></i>
                        </button>
                    </div>
                `;
                
                container.appendChild(userElement);
            });
            
            // Update claimed count in global stats
            updateYatirimStats();
        }

        function updateYatirimStats() {
            const totalSites = allSites.length;
            let totalUsers = 0;
            let claimedCount = 0;
            
            // Calculate total users from all sites
            Object.values(siteListeners).forEach(listener => {
                // We would need to track user counts per site
                // For simplicity, we'll update this in renderYatirimUsers
            });
            
            document.getElementById('total-sites-yatirim').textContent = totalSites;
            document.getElementById('total-users-yatirim').textContent = totalUsers;
            document.getElementById('claimed-count').textContent = claimedCount;
        }

        function updateYatirimEmptyState() {
            const siteList = document.getElementById('site-list');
            const emptyState = document.getElementById('empty-state-yatirim');
            
            if (siteList.children.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }

        function toggleSiteCard(cardId) {
            const card = document.getElementById(cardId);
            card.classList.toggle('open');
        }

        // ===== UTILITY FUNCTIONS =====
        function getDaysDiff(dateStr) {
            if (!dateStr || dateStr === "") return 999;
            const deposit = new Date(dateStr);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            deposit.setHours(0, 0, 0, 0);
            return Math.floor((today - deposit) / (1000 * 60 * 60 * 24));
        }

        function updateTabCounts() {
            // Update tab 1 count (promo codes)
            document.getElementById('tab1-count').textContent = allPromoCodes.length;
            
            // Update tab 2 count (total sites)
            document.getElementById('tab2-count').textContent = allSites.length;
        }

        // ===== SEARCH FUNCTIONALITY =====
        function initSearch() {
            // Promo search
            const searchPromo = document.getElementById('search-promo');
            searchPromo.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    document.querySelectorAll('#promo-list .site-card').forEach(card => {
                        card.style.display = 'block';
                    });
                    return;
                }
                
                document.querySelectorAll('#promo-list .site-card').forEach(card => {
                    const siteName = card.querySelector('.site-card-name').textContent.toLowerCase();
                    const hasMatch = siteName.includes(searchTerm);
                    card.style.display = hasMatch ? 'block' : 'none';
                });
            });
            
            // Yatirim search
            const searchYatirim = document.getElementById('search-yatirim');
            searchYatirim.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase().trim();
                
                document.querySelectorAll('#site-list .site-card').forEach(card => {
                    const siteName = card.querySelector('.site-card-name').textContent.toLowerCase();
                    const users = card.querySelectorAll('.user-name-yatirim');
                    let hasMatch = siteName.includes(searchTerm);
                    
                    // Check users
                    users.forEach(user => {
                        if (user.textContent.toLowerCase().includes(searchTerm)) {
                            hasMatch = true;
                        }
                    });
                    
                    card.style.display = hasMatch || searchTerm === '' ? 'block' : 'none';
                });
            });
        }

        // ===== DATA EXPORT/IMPORT =====
        async function exportPromoData() {
            try {
                const snapshot = await db.collection('promoCodes').get();
                const data = [];
                
                snapshot.forEach(doc => {
                    data.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `promosyon-kodlari-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showToast('Promosyon kodları dışa aktarıldı!', 'success');
            } catch (error) {
                showToast('Dışa aktarma sırasında hata oluştu!', 'danger');
                console.error(error);
            }
        }

        async function exportYatirimData() {
            try {
                const allData = {};
                
                for (const site of allSites) {
                    const dbAd = site.replace(/\s/g, '').toUpperCase();
                    const snapshot = await db.collection(dbAd).get();
                    allData[site] = [];
                    
                    snapshot.forEach(doc => {
                        allData[site].push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                }
                
                const dataStr = JSON.stringify(allData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `yatirim-verileri-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                showToast('Yatırım verileri dışa aktarıldı!', 'success');
            } catch (error) {
                showToast('Dışa aktarma sırasında hata oluştu!', 'danger');
                console.error(error);
            }
        }

        function importPromoData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async e => {
                const file = e.target.files[0];
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    showConfirmModal(
                        `${data.length} promosyon kaydı içe aktarılacak. Devam etmek istiyor musunuz?`,
                        async () => {
                            try {
                                const batch = db.batch();
                                const promoCodesRef = db.collection('promoCodes');
                                
                                data.forEach(item => {
                                    const newDocRef = promoCodesRef.doc();
                                    batch.set(newDocRef, {
                                        siteName: item.siteName,
                                        userName: item.userName,
                                        promoDate: item.promoDate || new Date().toISOString().split('T')[0],
                                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                    });
                                });
                                
                                await batch.commit();
                                showToast('Promosyon kodları içe aktarıldı!', 'success');
                                hideModal('confirm');
                            } catch (error) {
                                showToast('İçe aktarma sırasında hata oluştu!', 'danger');
                                console.error(error);
                            }
                        },
                        'İçe Aktar'
                    );
                } catch (error) {
                    showToast('Dosya okuma sırasında hata oluştu!', 'danger');
                    console.error(error);
                }
            };
            
            input.click();
        }

        function importYatirimData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async e => {
                const file = e.target.files[0];
                try {
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    let totalUsers = 0;
                    for (const [siteName, users] of Object.entries(data)) {
                        totalUsers += users.length;
                    }
                    
                    showConfirmModal(
                        `${Object.keys(data).length} site ve toplam ${totalUsers} kullanıcı içe aktarılacak. Devam etmek istiyor musunuz?`,
                        async () => {
                            try {
                                for (const [siteName, users] of Object.entries(data)) {
                                    const dbAd = siteName.replace(/\s/g, '').toUpperCase();
                                    
                                    // Add site if not exists
                                    if (!allSites.includes(siteName)) {
                                        allSites.push(siteName);
                                        createSiteCard(siteName);
                                    }
                                    
                                    for (const user of users) {
                                        await db.collection(dbAd).add({
                                            name: user.name,
                                            lastDepositDate: user.lastDepositDate || "",
                                            lastClaimDate: user.lastClaimDate || "",
                                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                        });
                                    }
                                }
                                
                                showToast('Yatırım verileri içe aktarıldı!', 'success');
                                hideModal('confirm');
                            } catch (error) {
                                showToast('İçe aktarma sırasında hata oluştu!', 'danger');
                                console.error(error);
                            }
                        },
                        'İçe Aktar'
                    );
                } catch (error) {
                    showToast('Dosya okuma sırasında hata oluştu!', 'danger');
                    console.error(error);
                }
            };
            
            input.click();
        }

        function clearPromoData() {
            showConfirmModal(
                'TÜM promosyon kayıtlarını silmek istediğinize emin misiniz? Bu işlem geri alınamaz!',
                async () => {
                    try {
                        const snapshot = await db.collection('promoCodes').get();
                        const batch = db.batch();
                        
                        snapshot.forEach(doc => {
                            batch.delete(doc.ref);
                        });
                        
                        await batch.commit();
                        showToast('Promosyon kodları temizlendi!', 'success');
                        hideModal('confirm');
                    } catch (error) {
                        showToast('Silme sırasında hata oluştu!', 'danger');
                        console.error(error);
                    }
                },
                'Tümünü Sil'
            );
        }

        // ===== TOAST NOTIFICATION =====
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 30px;
                background: ${type === 'success' ? 'var(--success)' : 
                           type === 'warning' ? 'var(--warning)' : 
                           type === 'danger' ? 'var(--danger)' : 'var(--primary)'};
                color: white;
                padding: 15px 25px;
                border-radius: 15px;
                box-shadow: var(--shadow-outset);
                animation: toastSlideIn 0.3s ease;
                display: flex;
                align-items: center;
                gap: 12px;
                max-width: 350px;
                z-index: 9999;
                font-weight: 500;
            `;
            
            const icon = type === 'success' ? 'fa-check-circle' :
                        type === 'warning' ? 'fa-exclamation-triangle' :
                        type === 'danger' ? 'fa-times-circle' : 'fa-info-circle';
            
            toast.innerHTML = `
                <i class="fas ${icon}" style="font-size: 20px;"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'toastSlideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
            
            // Add animation keyframes
            if (!document.querySelector('#toast-animations')) {
                const style = document.createElement('style');
                style.id = 'toast-animations';
                style.textContent = `
                    @keyframes toastSlideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes toastSlideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // ===== INITIALIZATION =====
        function init() {
            // Initialize theme
            initTheme();
            
            // Setup theme toggle
            document.getElementById('theme-switch').addEventListener('change', function() {
                setTheme(this.checked ? 'dark' : 'light');
            });
            
            // Load custom sites from localStorage
            const customSites = JSON.parse(localStorage.getItem('customSites') || '[]');
            allSites = [...sites, ...customSites];
            
            // Create site cards for yatirim panel
            allSites.forEach(siteName => {
                createSiteCard(siteName);
            });
            
            // Initialize search
            initSearch();
            
            // Setup real-time listener for promo codes
            db.collection('promoCodes').orderBy("createdAt", "desc")
                .onSnapshot(snapshot => {
                    allPromoCodes = [];
                    snapshot.forEach(doc => {
                        allPromoCodes.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    
                    const grouped = groupPromosBySite(allPromoCodes);
                    renderPromoCards(grouped);
                });
            
            // Set today's date as default for promo date input
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('promo-date-input').value = today;
            
            // Focus on site name input when tab 1 is active
            setTimeout(() => {
                if (currentTab === 1) {
                    document.getElementById('site-name-input').focus();
                }
            }, 500);
            
            // Update tab counts
            updateTabCounts();
        }

        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
