<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XP Yönetim Paneli</title>

<link rel="icon" type="image/png" href="https://ui-avatars.com/api/?name=XP&background=0a246a&color=fff&rounded=true">

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
:root{
  --xp-bg:#ece9d8;
  --xp-panel:#f6f6f6;
  --xp-border:#7f7f7f;
  --xp-border-light:#ffffff;
  --xp-border-dark:#404040;
  --xp-blue:#0a246a;
  --xp-green:#0b8a00;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--xp-bg);
  font-family:Tahoma, Verdana, Arial;
  font-size:12px;
  color:#000;
}

/* ANA PENCERE */
.container{
  max-width:620px;
  margin:12px auto;
  background:var(--xp-panel);
  border:1px solid var(--xp-border-dark);
  box-shadow:
    inset 1px 1px 0 var(--xp-border-light),
    inset -1px -1px 0 var(--xp-border);
}

/* BAŞLIK */
.titlebar{
  background:linear-gradient(#0a246a,#3a6ea5);
  color:#fff;
  padding:4px 8px;
  font-weight:bold;
  font-size:12px;
}

/* ARAÇ ÇUBUĞU */
.toolbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:4px 6px;
  background:#d4d0c8;
  border-top:1px solid var(--xp-border-light);
  border-bottom:1px solid var(--xp-border-dark);
}

/* BUTON */
button{
  font-family:Tahoma;
  font-size:11px;
  padding:2px 10px;
  border-top:1px solid var(--xp-border-light);
  border-left:1px solid var(--xp-border-light);
  border-right:1px solid var(--xp-border-dark);
  border-bottom:1px solid var(--xp-border-dark);
  background:#d4d0c8;
  cursor:pointer;
}
button:active{
  border-top:1px solid var(--xp-border-dark);
  border-left:1px solid var(--xp-border-dark);
  border-right:1px solid var(--xp-border-light);
  border-bottom:1px solid var(--xp-border-light);
}

/* SWITCH */
.switch{
  display:flex;
  align-items:center;
  gap:4px;
  font-size:11px;
}

input[type="checkbox"]{
  width:13px;
  height:13px;
}

/* SITE */
.site-item{
  border-bottom:1px solid #b5b5b5;
}

.site-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:4px 6px;
  background:#efefef;
  cursor:pointer;
}
.site-header:hover{
  background:#e0e0e0;
}

.drag-handle{
  margin-right:6px;
  cursor:move;
}

/* İÇERİK */
.site-content{
  display:none;
  padding:6px;
  background:#fff;
  border-top:1px solid #b5b5b5;
}

/* KULLANICI */
.user-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:3px 0;
  border-bottom:1px dotted #c0c0c0;
}

.user-info{
  display:flex;
  align-items:center;
  gap:6px;
}

.led{
  width:10px;
  height:10px;
  border:1px solid #000;
  background:#9e9e9e;
  cursor:pointer;
}
.led.active{
  background:var(--xp-green);
}

.status-text{
  font-size:10px;
  color:#333;
}

/* EKLE */
.controls{
  display:flex;
  gap:4px;
  margin-top:6px;
}

input[type="text"]{
  flex:1;
  padding:2px 4px;
  font-family:Tahoma;
  font-size:11px;
  border-top:1px solid var(--xp-border-dark);
  border-left:1px solid var(--xp-border-dark);
  border-right:1px solid var(--xp-border-light);
  border-bottom:1px solid var(--xp-border-light);
}

.del-btn{
  font-size:10px;
  padding:2px 6px;
  background:#e6b0b0;
}
</style>
</head>

<body>

<div class="container">
  <div class="titlebar">Yönetim Paneli – Windows XP</div>

  <div class="toolbar">
    <div class="switch">
      <input type="checkbox" id="drag-switch" onchange="toggleDragAbility()">
      <label for="drag-switch">Sıralama</label>
    </div>
    <button onclick="resetAllStatus()">Sıfırla</button>
  </div>

  <div id="site-list"></div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyA_AB1QtRr3bBHi5LXxeTKECtgPJrfyRa4",
  authDomain:"deneme-b8281.firebaseapp.com",
  projectId:"deneme-b8281"
});
const db=firebase.firestore();

let siteler=["HIZLICASİNO","EGEBET","KAVBET","PUSULABET","HITBET","TURBOSLOT","MATBET","JOJOBET"];
let sortableInstance;

async function init(){
  const doc=await db.collection("settings").doc("siteOrder").get();
  if(doc.exists) siteler=doc.data().list;
  render();
}

function render(){
  siteList.innerHTML="";
  siteler.forEach(site=>{
    const div=document.createElement("div");
    div.className="site-item";
    div.dataset.id=site;
    div.innerHTML=`
      <div class="site-header" onclick="toggleMenu('${site}')">
        <div><span class="drag-handle">☰</span>${site}</div>
        <span id="count-${site}">...</span>
      </div>
      <div class="site-content" id="content-${site}">
        <div id="users-${site}"></div>
        <div class="controls">
          <input id="input-${site}" placeholder="Kullanıcı adı">
          <button onclick="addUser('${site}')">Ekle</button>
        </div>
      </div>`;
    siteList.appendChild(div);
    db.collection(site).orderBy("createdAt").onSnapshot(s=>renderUsers(site,s));
  });

  sortableInstance=new Sortable(siteList,{
    handle:".site-header",
    disabled:true,
    onEnd:saveOrder
  });
}

function toggleMenu(id){
  const el=document.getElementById("content-"+id);
  el.style.display=el.style.display==="block"?"none":"block";
}

function toggleDragAbility(){
  sortableInstance.option("disabled",!document.getElementById("drag-switch").checked);
}

function saveOrder(){
  const list=[...document.querySelectorAll(".site-item")].map(i=>i.dataset.id);
  db.collection("settings").doc("siteOrder").set({list});
}

function addUser(site){
  const i=document.getElementById("input-"+site);
  if(!i.value.trim())return;
  db.collection(site).add({
    name:i.value,
    status:false,
    date:"",
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
  i.value="";
}

function toggleStatus(site,id,status){
  const d=status?"":new Date().toLocaleString("tr-TR");
  db.collection(site).doc(id).update({status:!status,date:d});
}

function renderUsers(site,snapshot){
  const box=document.getElementById("users-"+site);
  const cnt=document.getElementById("count-"+site);
  box.innerHTML="";
  cnt.innerText=snapshot.size+" kişi";
  snapshot.forEach(doc=>{
    const u=doc.data();
    box.innerHTML+=`
    <div class="user-row">
      <div class="user-info">
        <div class="led ${u.status?"active":""}" onclick="toggleStatus('${site}','${doc.id}',${u.status})"></div>
        <div>
          <b>${u.name}</b>
          <div class="status-text">${u.status?"Kod Alındı":"Kod Alınmadı"}</div>
        </div>
      </div>
      <button class="del-btn" onclick="db.collection('${site}').doc('${doc.id}').delete()">Sil</button>
    </div>`;
  });
}

async function resetAllStatus(){
  if(!confirm("Hepsi sıfırlansın mı?"))return;
  for(const s of siteler){
    const snap=await db.collection(s).where("status","==",true).get();
    snap.forEach(d=>db.collection(s).doc(d.id).update({status:false,date:""}));
  }
}

const siteList=document.getElementById("site-list");
init();
</script>

</body>
</html>
